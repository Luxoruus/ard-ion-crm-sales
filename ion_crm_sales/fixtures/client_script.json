[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Opportunity",
  "enabled": 1,
  "modified": "2025-08-11 19:20:37.998484",
  "module": "Ion Crm Sales",
  "name": "Opportunity Workflow",
  "script": "frappe.ui.form.on('Opportunity', {\n    \n    opportunity_from: function(frm){\n        switch (frm.doc.opportunity_from){\n            case \"Customer\":\n                frm.doc.sales_stage = 'Opportunity';\n                break;\n            case \"Prospect\":\n                frm.doc.sales_stage = 'Prospecting';\n                break;\n        }\n    },\n    \n    refresh: function(frm) {\n        if (['Requirements Gathering', 'Surveying', 'Approved'].includes(frm.doc.workflow_state)){\n            frm.$wrapper.find(\".actions-btn-group\").hide()\n        } else {\n            frm.$wrapper.find(\".actions-btn-group\").show()\n        }\n        \n        if (frm.doc.opportunity_type === 'Sales') {\n            frm.set_value('opportunity_type', 'Dedicated');\n        }\n        \n        if (!frm.doc.custom_request){\n            frm.set_df_property('custom_requirements', 'read_only', 1)\n        }\n        \n        if ([\"Requirements Gathering\"].includes(frm.doc.workflow_state)) {\n            frm.$wrapper.find(\"[data-fieldname='custom_scope']\").hide();\n        } else {\n            frm.$wrapper.find(\"[data-fieldname='custom_scope']\").show();\n        }\n        \n        \n        if ([\"Requirements Gathering\", \"Scoping\"].includes(frm.doc.workflow_state)){\n            frm.$wrapper.find(\"[data-fieldname='custom_qa']\").hide();\n        } else {\n            frm.$wrapper.find(\"[data-fieldname='custom_qa']\").show();\n        }\n        \n        if ([\"Requirements Gathering\", \"Scoping\", \"Qualifying\"].includes(frm.doc.workflow_state) || frm.doc.workflow_state == \"Rejected\") {\n            frm.$wrapper.find(\"[data-fieldname='custom_survey']\").hide();\n        } else {\n            frm.$wrapper.find(\"[data-fieldname='custom_survey']\").show();\n        }\n        \n        if ([\"Requirements Gathering\", \"Scoping\", \"Qualifying\", \"Surveying\"].includes(frm.doc.workflow_state) || frm.doc.workflow_state == \"Rejected\") {\n            frm.$wrapper.find(\"[data-fieldname='items_section']\").hide();\n        } else {\n            frm.$wrapper.find(\"[data-fieldname='items_section']\").show();\n        }\n        \n        \n        frm.$wrapper.find('.inner-group-button[data-label=\"Create\"]').hide()\n        frm.$wrapper.find('.inner-group-button[data-label=\"Create\"] .dropdown-item').hide()\n        \n        if (!['Requirements Gathering', 'Scoping', 'Qualifying', 'Rejected'].includes(frm.doc.workflow_state) && frm.doc.opportunity_from == 'Prospect'){\n            frm.$wrapper.find('.inner-group-button[data-label=\"Create\"]').show()\n            frm.$wrapper.find('.inner-group-button[data-label=\"Create\"] .dropdown-item[data-label=\"Customer\"]').show()\n        }\n        \n        if (frm.doc.workflow_state == \"Approved\"){\n            frm.$wrapper.find('.inner-group-button[data-label=\"Create\"]').show()\n            frm.$wrapper.find('.inner-group-button[data-label=\"Create\"] .dropdown-item').show()\n        }\n\n    },\n    validate: function(frm){\n        if (frm.doc.custom_request){\n            frm.set_df_property('custom_requirements', 'read_only', 0)\n        }\n        \n        \n        if (frm.doc.custom_requirements && frm.doc.workflow_state !== \"Scoping\" && frm.doc.workflow_state == \"Requirements Gathering\") {\n            frm.set_value('workflow_state', 'Scoping');\n            frm.refresh()\n        }\n        \n        /*if (frm.doc.custom_surveys.length > 0 && frm.doc.workflow_state == \"Surveying\") {\n            frm.set_value('workflow_state', 'Technical Qualification');\n            frm.refresh()\n        }*/\n    }\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Opportunity Hotels",
  "enabled": 1,
  "modified": "2025-08-12 09:46:31.754878",
  "module": "Ion Crm Sales",
  "name": "Opportunity Hotels Workflow",
  "script": "frappe.ui.form.on('Opportunity Hotels', {\n    \n    opportunity_from: function(frm){\n        switch (frm.doc.opportunity_from){\n            case \"Customer\":\n                frm.doc.sales_stage = 'Opportunity';\n                frm.refresh_field('sales_stage')\n                break;\n            case \"Prospect\":\n                frm.doc.sales_stage = 'Prospecting';\n                frm.refresh_field('sales_stage')\n                break;\n        }\n    },\n    \n    refresh: function(frm) {\n        if (['Requirements Gathering', 'Scoping', 'Surveying', 'Approved'].includes(frm.doc.workflow_state)){\n            frm.$wrapper.find(\".actions-btn-group\").hide()\n        } else {\n            frm.$wrapper.find(\".actions-btn-group\").show()\n        }\n        \n        if (frm.doc.opportunity_type === 'Sales') {\n            frm.set_value('opportunity_type', 'Dedicated');\n        }\n        \n        if (!frm.doc.custom_request){\n            frm.set_df_property('custom_requirements', 'read_only', 1)\n        }\n        \n        if ([\"Requirements Gathering\"].includes(frm.doc.workflow_state)) {\n            frm.$wrapper.find(\"[data-fieldname='custom_scope']\").hide();\n        } else {\n            frm.$wrapper.find(\"[data-fieldname='custom_scope']\").show();\n        }\n        \n        \n        if ([\"Requirements Gathering\", \"Scoping\"].includes(frm.doc.workflow_state)){\n            frm.$wrapper.find(\"[data-fieldname='custom_qa']\").hide();\n        } else {\n            frm.$wrapper.find(\"[data-fieldname='custom_qa']\").show();\n        }\n        \n        if ([\"Requirements Gathering\", \"Scoping\", \"Qualifying\"].includes(frm.doc.workflow_state) || frm.doc.workflow_state == \"Rejected\") {\n            frm.$wrapper.find(\"[data-fieldname='custom_survey']\").hide();\n        } else {\n            frm.$wrapper.find(\"[data-fieldname='custom_survey']\").show();\n        }\n        \n        \n        if (frm.doc.custom_surveys.length == 0){\n            frm.$wrapper.find(\"[data-fieldname='items_section']\").hide()\n        } else {\n            frm.$wrapper.find(\"[data-fieldname='items_section']\").show()\n        }\n        \n        \n        frm.$wrapper.find('.inner-group-button[data-label=\"Create\"]').hide()\n        frm.$wrapper.find('.inner-group-button[data-label=\"Create\"] .dropdown-item').hide()\n        \n        if (!['Requirements Gathering', 'Scoping', 'Qualifying', 'Rejected'].includes(frm.doc.workflow_state) && frm.doc.opportunity_from == 'Prospect'){\n            frm.$wrapper.find('.inner-group-button[data-label=\"Create\"]').show()\n            frm.$wrapper.find('.inner-group-button[data-label=\"Create\"] .dropdown-item[data-label=\"Customer\"]').show()\n        }\n        \n        if (frm.doc.workflow_state == \"Approved\"){\n            setTimeout(() => {\n            frm.$wrapper.find('.inner-group-button[data-label=\"Create\"]').show()\n            frm.$wrapper.find('.inner-group-button[data-label=\"Create\"] .dropdown-item').show()\n                \n            }, 300)\n        }\n        \n        if (frm.doc.workflow_state == \"Surveyed\"){\n            frm.$wrapper.find(\".actions-btn-group\").show()\n            setTimeout(() => {\n                frm.$wrapper.find(\".actions-btn-group .dropdown-item\").show()\n                frm.$wrapper.find(\".actions-btn-group .dropdown-item:has(.menu-item-label[data-label='Approve'])\").hide()\n                \n            }, 300)\n            \n            \n            if (frm.doc.items.length > 0){\n                setTimeout(() => {\n                    frm.$wrapper.find('.actions-btn-group .dropdown-item:has(.menu-item-label[data-label=\"Approve\"])').show()\n                }, 300)\n            }\n        }\n\n    },\n    validate: function(frm){\n        if (frm.doc.custom_request){\n            frm.set_df_property('custom_requirements', 'read_only', 0)\n        }\n        \n        \n        if (frm.doc.custom_requirements && frm.doc.workflow_state !== \"Scoping\" && frm.doc.workflow_state == \"Requirements Gathering\") {\n            frm.set_value('workflow_state', 'Scoping');\n            frm.refresh()\n        }\n        \n        if (frm.doc.custom_scope_description && frm.doc.custom_deliverables && frm.doc.workflow_state == \"Scoping\"){\n            frm.set_value('workflow_state', 'Qualifying')\n            frm.refresh()\n        }\n    }\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Opportunity SM",
  "enabled": 1,
  "modified": "2025-08-12 09:45:43.800634",
  "module": "Ion Crm Sales",
  "name": "Opportunity SM Workflow",
  "script": "frappe.ui.form.on('Opportunity SM', {\n    \n    opportunity_from: function(frm){\n        switch (frm.doc.opportunity_from){\n            case \"Customer\":\n                frm.doc.sales_stage = 'Opportunity';\n                frm.refresh_field('sales_stage')\n                break;\n            case \"Prospect\":\n                frm.doc.sales_stage = 'Prospecting';\n                frm.refresh_field('sales_stage')\n                break;\n        }\n    },\n    \n    refresh: function(frm) {\n        if (['Requirements Gathering', 'Scoping', 'Surveying', 'Approved'].includes(frm.doc.workflow_state)){\n            frm.$wrapper.find(\".actions-btn-group\").hide()\n        } else {\n            frm.$wrapper.find(\".actions-btn-group\").show()\n        }\n        \n        if (frm.doc.opportunity_type === 'Sales') {\n            frm.set_value('opportunity_type', 'Dedicated');\n        }\n        \n        if (!frm.doc.custom_request){\n            frm.set_df_property('custom_requirements', 'read_only', 1)\n        }\n        \n        if ([\"Requirements Gathering\"].includes(frm.doc.workflow_state)) {\n            frm.$wrapper.find(\"[data-fieldname='custom_scope']\").hide();\n        } else {\n            frm.$wrapper.find(\"[data-fieldname='custom_scope']\").show();\n        }\n        \n        \n        if ([\"Requirements Gathering\", \"Scoping\"].includes(frm.doc.workflow_state)){\n            frm.$wrapper.find(\"[data-fieldname='custom_qa']\").hide();\n        } else {\n            frm.$wrapper.find(\"[data-fieldname='custom_qa']\").show();\n        }\n        \n        if ([\"Requirements Gathering\", \"Scoping\", \"Qualifying\"].includes(frm.doc.workflow_state) || frm.doc.workflow_state == \"Rejected\") {\n            frm.$wrapper.find(\"[data-fieldname='custom_survey']\").hide();\n        } else {\n            frm.$wrapper.find(\"[data-fieldname='custom_survey']\").show();\n        }\n        \n        \n        if (frm.doc.custom_surveys.length == 0){\n            frm.$wrapper.find(\"[data-fieldname='items_section']\").hide()\n        } else {\n            frm.$wrapper.find(\"[data-fieldname='items_section']\").show()\n        }\n        \n        \n        frm.$wrapper.find('.inner-group-button[data-label=\"Create\"]').hide()\n        frm.$wrapper.find('.inner-group-button[data-label=\"Create\"] .dropdown-item').hide()\n        \n        if (!['Requirements Gathering', 'Scoping', 'Qualifying', 'Rejected'].includes(frm.doc.workflow_state) && frm.doc.opportunity_from == 'Prospect'){\n            frm.$wrapper.find('.inner-group-button[data-label=\"Create\"]').show()\n            frm.$wrapper.find('.inner-group-button[data-label=\"Create\"] .dropdown-item[data-label=\"Customer\"]').show()\n        }\n        \n        if (frm.doc.workflow_state == \"Approved\"){\n            setTimeout(() => {\n            frm.$wrapper.find('.inner-group-button[data-label=\"Create\"]').show()\n            frm.$wrapper.find('.inner-group-button[data-label=\"Create\"] .dropdown-item').show()\n                \n            }, 300)\n        }\n        \n        if (frm.doc.workflow_state == \"Surveyed\"){\n            frm.$wrapper.find(\".actions-btn-group\").show()\n            setTimeout(() => {\n                frm.$wrapper.find(\".actions-btn-group .dropdown-item\").show()\n                frm.$wrapper.find(\".actions-btn-group .dropdown-item:has(.menu-item-label[data-label='Approve'])\").hide()\n                \n            }, 300)\n            \n            \n            if (frm.doc.items.length > 0){\n                setTimeout(() => {\n                    frm.$wrapper.find('.actions-btn-group .dropdown-item:has(.menu-item-label[data-label=\"Approve\"])').show()\n                }, 300)\n            }\n        }\n\n    },\n    validate: function(frm){\n        if (frm.doc.custom_request){\n            frm.set_df_property('custom_requirements', 'read_only', 0)\n        }\n        \n        \n        if (frm.doc.custom_requirements && frm.doc.workflow_state !== \"Scoping\" && frm.doc.workflow_state == \"Requirements Gathering\") {\n            frm.set_value('workflow_state', 'Scoping');\n            frm.refresh()\n        }\n        \n        if (frm.doc.custom_scope_description && frm.doc.custom_deliverables && frm.doc.workflow_state == \"Scoping\"){\n            frm.set_value('workflow_state', 'Qualifying')\n            frm.refresh()\n        }\n    }\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Opportunity Tenders",
  "enabled": 1,
  "modified": "2025-08-12 09:46:10.714860",
  "module": "Ion Crm Sales",
  "name": "Opportunity Tenders Workflow",
  "script": "frappe.ui.form.on('Opportunity Tenders', {\n    \n    opportunity_from: function(frm){\n        switch (frm.doc.opportunity_from){\n            case \"Customer\":\n                frm.doc.sales_stage = 'Opportunity';\n                frm.refresh_field('sales_stage')\n                break;\n            case \"Prospect\":\n                frm.doc.sales_stage = 'Prospecting';\n                frm.refresh_field('sales_stage')\n                break;\n        }\n    },\n    \n    refresh: function(frm) {\n        if (['RFP', 'Scoping', 'Surveying', 'Approved'].includes(frm.doc.workflow_state)){\n            frm.$wrapper.find(\".actions-btn-group\").hide()\n        } else {\n            frm.$wrapper.find(\".actions-btn-group\").show()\n        }\n        \n        if (frm.doc.opportunity_type === 'Sales') {\n            frm.set_value('opportunity_type', 'Dedicated');\n        }\n        \n        if ([\"RFP\"].includes(frm.doc.workflow_state)) {\n            frm.$wrapper.find(\"[data-fieldname='custom_scope']\").hide();\n        } else {\n            frm.$wrapper.find(\"[data-fieldname='custom_scope']\").show();\n        }\n        \n        \n        if ([\"RFP\", \"Scoping\"].includes(frm.doc.workflow_state)){\n            frm.$wrapper.find(\"[data-fieldname='custom_qa']\").hide();\n        } else {\n            frm.$wrapper.find(\"[data-fieldname='custom_qa']\").show();\n        }\n        \n        if ([\"RFP\", \"Scoping\"].includes(frm.doc.workflow_state) || frm.doc.workflow_state == \"Rejected\") {\n            frm.$wrapper.find(\"[data-fieldname='custom_survey']\").hide();\n        } else {\n            frm.$wrapper.find(\"[data-fieldname='custom_survey']\").show();\n        }\n        \n        \n        if (frm.doc.custom_surveys.length == 0){\n            frm.$wrapper.find(\"[data-fieldname='items_section']\").hide()\n        } else {\n            frm.$wrapper.find(\"[data-fieldname='items_section']\").show()\n        }\n        \n        \n        frm.$wrapper.find('.inner-group-button[data-label=\"Create\"]').hide()\n        frm.$wrapper.find('.inner-group-button[data-label=\"Create\"] .dropdown-item').hide()\n        \n        if (!['RFP', 'Scoping', 'Qualifying', 'Rejected'].includes(frm.doc.workflow_state) && frm.doc.opportunity_from == 'Prospect'){\n            frm.$wrapper.find('.inner-group-button[data-label=\"Create\"]').show()\n            frm.$wrapper.find('.inner-group-button[data-label=\"Create\"] .dropdown-item[data-label=\"Customer\"]').show()\n        }\n        \n        if (frm.doc.workflow_state == \"Approved\"){\n            setTimeout(() => {\n            frm.$wrapper.find('.inner-group-button[data-label=\"Create\"]').show()\n            frm.$wrapper.find('.inner-group-button[data-label=\"Create\"] .dropdown-item').show()\n                \n            }, 300)\n        }\n        \n        if (frm.doc.workflow_state == \"Surveyed\"){\n            frm.$wrapper.find(\".actions-btn-group\").show()\n            setTimeout(() => {\n                frm.$wrapper.find(\".actions-btn-group .dropdown-item\").show()\n                frm.$wrapper.find(\".actions-btn-group .dropdown-item:has(.menu-item-label[data-label='Approve'])\").hide()\n                \n            }, 300)\n            \n            \n            if (frm.doc.items.length > 0){\n                setTimeout(() => {\n                    frm.$wrapper.find('.actions-btn-group .dropdown-item:has(.menu-item-label[data-label=\"Approve\"])').show()\n                }, 300)\n            }\n        }\n\n    },\n    validate: function(frm){\n        \n        if (frm.doc.custom_rfp_document && frm.doc.workflow_state !== \"Scoping\" && frm.doc.workflow_state == \"RFP\") {\n            frm.set_value('workflow_state', 'Scoping');\n            frm.refresh()\n        }\n        \n        if (frm.doc.custom_scope_description && frm.doc.custom_deliverables && frm.doc.custom_cxo_team.length > 0 && frm.doc.custom_cxo_team_leader && frm.doc.workflow_state == \"Scoping\"){\n            frm.set_value('workflow_state', 'Surveying')\n            frm.refresh()\n        }\n    }\n});",
  "view": "Form"
 }
]